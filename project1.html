<!DOCTYPE html><html lang="en"><head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="stylesheet" href="css/style.css"> <title>Niels Van Nerum</title> <link rel="icon" type="image/png" href="/assets/iconsfavicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/svg+xml" href="/assets/iconsfavicon.svg"> <link rel="shortcut icon" href="/assets/iconsfavicon.ico"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/iconsapple-touch-icon.png"> <link rel="manifest" href="/assets/iconssite.webmanifest"></head> <body> <div class="opacity-header fixed-top"> <nav class="d-flex justify-content-between container mt-3"> <h1 class="mt-3"> <a href="index.html"> Portfolio <br> <span class="heading-title fw-bold">Niels Van Nerum</span> </a> </h1> <div class="mt-5 navigation"> <a href="about-me.html">About me</a> <a href="internship.html">Internship</a> <a href="projects.html">Projects</a> </div> <div class="mt-5 fw-bold d-none d-lg-block"> <a href="assets/CV_NielsVanNerum.pdf" id="download-CV" download="">Download CV</a> </div> </nav> </div> <article class="container main-content"> <h1 class="text-center">Audio Spectrum Analyzer</h1> <div class="row mt-4 mb-5"> <div class="col-lg-8 col-md-12"> <div id="projectCarousel" class="carousel slide rounded-2 subtle-box-shadow" data-bs-ride="carousel"> <div class="carousel-inner rounded-2"> <div class="carousel-item active"> <img src="assets/project1/msgeq7.png" class="d-block w-100" alt="inner workings of msgeq7 chip"> </div> <div class="carousel-item"> <img src="assets/project1/DigitalFilter.gif" class="d-block w-100" alt="sketch on how digital filters work"> </div> <div class="carousel-item"> <img src="assets/project1/render.jpg" class="d-block w-100" alt="3D render of the project"> </div> <div class="carousel-item"> <img src="assets/project1/amplifier.png" class="d-block w-100" alt="amplifier scheme"> </div> <div class="carousel-item"> <img src="assets/project1/nyquist.jpg" class="d-block w-100" alt="nyquist theorem"> </div> <div class="carousel-item"> <img src="assets/project1/calculations.png" class="d-block w-100" alt="digital filter calculations"> </div> </div> <button class="carousel-control-prev" type="button" data-bs-target="#projectCarousel" data-bs-slide="prev"> <span class="carousel-control-prev-icon" aria-hidden="true"></span> <span class="visually-hidden">Previous</span> </button> <button class="carousel-control-next" type="button" data-bs-target="#projectCarousel" data-bs-slide="next"> <span class="carousel-control-next-icon" aria-hidden="true"></span> <span class="visually-hidden">Next</span> </button> </div> </div> <div class="col-lg-4 col-md-12 mt-4 mt-lg-0 subtle-box-shadow p-3 rounded-2"> <h3 class="mb-3">Project Information</h3> <hr> <p class="mb-0 fw-bold">Technology used:</p> <ul> <li>Raspberry Pi Pico (RP2040)</li> <li>C++ for microcontroller programming</li> <li>Arduino UART communication</li> <li>Fusion360 for design</li> <li>Signal Processing: Analog/Digital filters, Fourier Transform</li> </ul> <p class="mb-0 fw-bold">Skills developed:</p> <ul> <li>Microcontroller programming</li> <li>Embedded systems design</li> <li>Digital signal processing</li> <li>3D CAD design</li> <li>Hardware circuit design</li> </ul> <p class="mb-0 fw-bold">Soft skills:</p> <ul> <li>Problem solving</li> <li>Perseverance</li> <li>Self-directed learning</li> </ul> </div> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Project Overview</h3> <p> After finding some interesting videos online of people making so-called <span class="fw-bold">"Audio Spectrum Analyzers"</span>, I did some research behind these machines and found out they were quite easy to make. They use a chip called <span class="fw-bold">"MSGEQ7"</span> which filters audio based on frequencies. I'm a big music fan so I was keen on making one for myself. Little did I know this project would grow out to be something <span class="fw-bold">insanely difficult</span> and big. After ordering one from the internet, but sadly getting an <span class="fw-bold">empty chip</span>, I did some research. Turns out these chips are often used in <span class="fw-bold">scamming practices</span>. I had however by now set up some of the rest of the things I would need to make this machine. So I was determined to find a solution to this problem. This is where I explored the broad field of <span class="fw-bold">signal processing</span>. Something that would become a big passion of mine for almost an entire year. </p> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Learning &amp; Approach</h3> <p> I learned about; <span class="fw-bold">analog filters</span>, <span class="fw-bold">Fourier transform</span>, and <span class="fw-bold">digital filters</span>. All in the attempt of finding the best solution for my project. In the end, I was set on using <span class="fw-bold">digital filters</span>. Since those were also used in the chip I tried to buy and offered the best characteristics. However, the digital filters inside the chip were manufactured with <span class="fw-bold">microscopic transistors</span>. If I were to make the same thing it would result in a human sized PCB. So I had to implement the digital filters in <span class="fw-bold">code</span>. Implementing digital filters in code proposed another problem however, I needed a <span class="fw-bold">small microcontroller</span> that would fit inside my project while also being extremely fast. A friend suggested, which at that time had just been released, the <span class="fw-bold">Raspberry Pi Pico</span>. It featured a <span class="fw-bold">125 MHz dual-core chip</span> with a wide variety of pin features. </p> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Design &amp; Build</h3> <p> By now I had drawn my device in <span class="fw-bold">Fusion360</span>. It featured a base which would house the electronics, heightened by some rubber feet. Each frequency would be represented by ten <span class="fw-bold">polymethylmethacrylate cubes</span> which would reflect the colour of the <span class="fw-bold">LED-strip</span> behind the "towers". Depending on the strength of the individual frequencies in the signal the LED towers would light up. The back of the base would have an on-off switch and two audio auxiliary ports. One signal-in, one signal-out. The base would be made out of glossy black <span class="fw-bold">polymethylmethacrylate</span>. I <span class="fw-bold">laser cut</span> the pieces and glued them together, I added some additional support in the corners with some <span class="fw-bold">3D prints</span>. The towers are held up by two steel rods in the back. The see-through blocks are spaced with washers. Everything is tightened to keep it from sagging. I <span class="fw-bold">rendered</span> the 3D drawing giving it reflections and more realism. </p> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Amplifier Circuit</h3> <p> We have to <span class="fw-bold">amplify</span> the input signal we are getting (phone), so it is workable. Since working with the initial signal from our phone would give us a very <span class="fw-bold">small analog range</span>. Our Raspberry Pi Pico can also not read <span class="fw-bold">negative inputs</span>. So we have to get rid of the negative signal. This circuit amplifies the signal by <span class="fw-bold">eleven times</span> and then adds a <span class="fw-bold">DC offset</span> of 1.65V. The 3.3V can be tapped from the power supply of the Pico, and 5V from the power supply of the LED strip. The <span class="fw-bold">input impedance</span> of the op-amp is infinitely large, ensuring that the current flowing through R3 will go to R4. The op-amp counteracts this current by sending an equally large current back through R4. However, the resistance is eleven times greater, so the voltage must also be eleven times greater to achieve the same current. Thus amplifying our input signal eleven times. </p> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Sampling &amp; Theory</h3> <p> We can now sample our audio, important here is the <span class="fw-bold">Nyquist theorem</span>, which states that to get a proper view of a signal we should sample it at <span class="fw-bold">double the max frequency</span> of the signal. Since humans can hear signals of 20 000 Hz we could use 40 000 as our sample rate. We use <span class="fw-bold">44 100 Hz</span> however since that is the <span class="fw-bold">industry standard</span> for audio. In order to sample at that frequency, we have to change the mode of the <span class="fw-bold">ADC (analog-digital converter)</span> to <span class="fw-bold">FIFO</span>. This way we can give our ADC a dedicated sample rate. Every time there is a new sample being made. The CPU is interrupted and the <span class="fw-bold">sample value</span> is stored. </p> </div> <div class="mb-5"> <h3 class="mb-3 text-center">Implementation &amp; Control</h3> <p> Next I implemented the <span class="fw-bold">digital filter</span> in code. This was done in <span class="fw-bold">C++</span>, this language is popular for programming microcontrollers. B and A are <span class="fw-bold">pre-calculated values</span> which I did in <span class="fw-bold">Python</span> using a library. After calculations, you also need to calculate the <span class="fw-bold">power of the filter</span>. We then display that power on the LED-strip. The LED-strip is controlled by an <span class="fw-bold">Arduino</span>. So the power of the filters is constantly sent to the Arduino via <span class="fw-bold">UART</span>. </p> </div> </article> <footer class="fixed-bottom bg-light border-top"> <div class="container py-2"> <div class="row align-items-center justify-content-between"> <div class="col-md-auto"> <p class="mb-0 fw-bold"> <a href="mailto:vannerumniels@gmail.com">vannerumniels@gmail.com</a> </p> </div> <div class="col-md-auto"> <a class="socials me-2 text-dark" href="https://www.linkedin.com/in/niels-van-nerum-6843041b1/" target="_blank"><i class="fa-brands fa-linkedin fa-lg"></i></a> <a class="socials text-dark" href="https://github.com/NielsVanNerum" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a> </div> </div> </div> </footer> <script src="js/bootstrap.bundle.min.js"></script> </body></html>